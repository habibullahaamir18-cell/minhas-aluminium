# Railway Deployment Debugging Guide

## Current Issue: 500 Internal Server Error

The backend is returning a 500 error even after adding environment variables. Here are the steps to debug:

---

## STEP 1: Force Railway Redeploy

After adding environment variables, Railway should auto-redeploy, but sometimes it doesn't. Force a redeploy:

### Option A: Trigger Redeploy from Dashboard
1. Go to Railway dashboard
2. Click on your backend service
3. Click "Deployments" tab
4. Click the three dots (...) on the latest deployment
5. Click "Redeploy"
6. Wait 2 minutes for deployment to complete

### Option B: Push a Small Change to GitHub
1. Make any small change to backend code (add a comment)
2. Commit and push to GitHub
3. Railway will auto-detect and redeploy

---

## STEP 2: Check Railway Deployment Logs

This is CRITICAL to see what's actually happening:

1. Go to Railway dashboard
2. Click on your backend service
3. Click "Deployments" tab
4. Click on the latest deployment
5. Look at the logs for:

**Success indicators:**
- ‚úÖ MongoDB Connected Successfully
- ‚úÖ Default admin user created
- üöÄ Server running on http://localhost:5000

**Error indicators:**
- ‚ùå MongoDB Connection Error
- MongooseError
- Authentication failed
- Network error

---

## STEP 3: Check MongoDB Atlas Network Access

MongoDB Atlas blocks connections by default. You need to allow Railway's IP:

1. Go to https://cloud.mongodb.com
2. Sign in to your account
3. Select your cluster: "minhasaluminium"
4. Click "Network Access" in the left sidebar
5. Check if "0.0.0.0/0" is in the IP Access List
   - If YES: Skip to Step 4
   - If NO: Continue below

### Add IP Access:
1. Click "Add IP Address"
2. Click "Allow Access from Anywhere"
3. This will add "0.0.0.0/0" (allows all IPs including Railway)
4. Click "Confirm"
5. Wait 1-2 minutes for changes to apply
6. Try logging in again

---

## STEP 4: Verify MongoDB Atlas Database User

1. In MongoDB Atlas, click "Database Access" in the left sidebar
2. Verify user "habibullahaamir18_db_user" exists
3. Check that it has "Read and write to any database" permissions
4. If password is wrong, click "Edit" and reset it
5. Update the MONGO_URI in Railway with the new password

---

## STEP 5: Test MongoDB Connection Locally

Test if the MongoDB connection string works:

1. Open your terminal
2. Navigate to backend folder:
   cd "d:\Projects\Upgraded Minhas Website\backend"

3. Make sure your .env file has:
   MONGO_URI=mongodb+srv://habibullahaamir18_db_user:w651ezowTMXApQpL@minhasaluminium.ed28hoe.mongodb.net/minhas_db?retryWrites=true&w=majority
   JWT_SECRET=minhas_aluminium_jwt_secret_2024

4. Run the backend locally:
   npm start

5. Check the console output:
   - If you see "‚úÖ MongoDB Connected Successfully" ‚Üí MongoDB is working
   - If you see "‚ùå MongoDB Connection Error" ‚Üí There's an issue with the connection string

6. If it works locally, the issue is with Railway environment variables

---

## STEP 6: Double-Check Railway Environment Variables

1. Go to Railway ‚Üí Your backend service ‚Üí Variables tab
2. Verify EXACTLY:

MONGO_URI should be:
mongodb+srv://habibullahaamir18_db_user:w651ezowTMXApQpL@minhasaluminium.ed28hoe.mongodb.net/minhas_db?retryWrites=true&w=majority

JWT_SECRET should be:
minhas_aluminium_jwt_secret_2024

3. Check for:
   - Extra spaces at the beginning or end
   - Missing characters
   - Wrong password

4. If anything is wrong, edit the variable and save
5. Railway will auto-redeploy

---

## STEP 7: Check Railway Build Logs

1. In Railway, click "Deployments" tab
2. Click on the latest deployment
3. Look for the "Build Logs" section
4. Check if there are any errors during:
   - npm install
   - Starting the server

---

## Common Issues and Solutions

### Issue: "MongooseError: Authentication failed"
**Solution:** 
- Password in MONGO_URI is wrong
- Check MongoDB Atlas ‚Üí Database Access ‚Üí User password
- Update MONGO_URI in Railway with correct password

### Issue: "MongoNetworkError: connection timed out"
**Solution:**
- MongoDB Atlas Network Access is blocking Railway
- Add 0.0.0.0/0 to IP Access List in MongoDB Atlas

### Issue: "Cannot find module 'dotenv'"
**Solution:**
- Dependencies not installed
- In Railway, trigger a redeploy

### Issue: "MONGO_URI is not defined"
**Solution:**
- Environment variable not set in Railway
- Double-check Variables tab in Railway

---

## Quick Checklist

Before asking for help, verify:
- [ ] Environment variables are set in Railway (MONGO_URI and JWT_SECRET)
- [ ] Railway has redeployed after adding variables
- [ ] MongoDB Atlas allows access from 0.0.0.0/0
- [ ] MongoDB user exists and has correct permissions
- [ ] Railway deployment logs show "MongoDB Connected Successfully"
- [ ] No typos in MONGO_URI or JWT_SECRET

---

## What to Do Next

1. **Check Railway Logs** (Most Important!)
   - This will tell you exactly what's wrong

2. **Check MongoDB Atlas Network Access**
   - Add 0.0.0.0/0 if not already there

3. **Force Redeploy in Railway**
   - Sometimes variables don't take effect until redeploy

4. **Test Locally**
   - If it works locally but not on Railway, it's a Railway config issue

---

## Need Help?

If you've tried all the above and it still doesn't work, provide:
1. Screenshot of Railway deployment logs
2. Screenshot of MongoDB Atlas Network Access page
3. Screenshot of Railway Variables tab
4. Error message from browser console

---

Last Updated: December 5, 2024
